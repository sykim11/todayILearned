---
title: 8. ë¬´ì‘ì • ì¥ê³ ë¡œ ì‚¬ì´ë“œí”„ë¡œì íŠ¸ ë§Œë“¤ê¸° - ë‚´ ì •ë³´ ìˆ˜ì •í•˜ê¸°
date: 2022-07-06T00:00
tags: ["Django"]
publish: true
image: "./django.jpg"
---

### ë§Œë“¤ì–´ë³¼ API ì¢…ë¥˜

- âœ… ë‚´ ì •ë³´ ìˆ˜ì • (/account/updateUser/)

\*\*\* accountapp(ì‚¬ìš©ìì§€ì •ëª…ì¹­)ì´ë¼ëŠ” ê³„ì •ê´€ë ¨í•œ ì¥ê³ ì•±ì´ ë§Œë“¤ì–´ì ¸ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì§„í–‰í•©ë‹ˆë‹¤.

#### ìƒˆë¡œìš´ serializer í´ë˜ìŠ¤ ìƒì„± ê¸°ì¤€

í”„ë¡ íŠ¸ì—ì„œ ë³´ë‚´ì˜¨ ìƒˆë¡œìš´ ë‚´ ì •ë³´ë¥¼ ë°›ì•„ ì§€ì •í•œ ëª¨ë¸ ì–‘ì‹ì— ë§ê²Œ ê²€ì¦ í›„, json í˜•íƒœë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.  
serializer í´ë˜ìŠ¤ë¥¼ ìƒˆë¡œ ìƒì„±í•´ì•¼í•˜ëŠ” ê¸°ì¤€ì´ ë¬´ì—‡ì¸ê°€ ê¶ê¸ˆí–ˆëŠ”ë° Meta ì˜ì—­ì—ì„œ ì§€ì •í•´ì£¼ëŠ” ê²½ìš°ê°€ ë‹¤ë¥´ë‹¤ë©´ ìƒˆë¡œìš´ serializer í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ”ê²Œ ì¢‹ì€ ê²ƒ ê°™ë‹¤.ğŸ‘ˆ

`fields`: í˜¸ì¶œ ë°›ëŠ” ë°ì´í„° ì˜ì—­

`extra_kwargs`: ë°ì´í„° ì§ë ¬í™”í•  ë•Œ ê° ë°ì´í„°ë§ˆë‹¤ ì˜µì…˜ì„ ì„¤ì •í•´ì£¼ëŠ” ì˜ì—­

```python
// accountapp > serializers.py
...
class AccountDetailSerializer(serializers.ModelSerializer):
    class Meta: ğŸ‘ˆ
        model = User
        fields = ('id', 'username', 'email', 'name', 'password',)
        extra_kwargs = {
            'id': {'read_only': True}, // ê³ ìœ í•œ id ê°’ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ë„ë¡
            'password': {'required': False, 'write_only': True}, // ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •ì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë©°, ì“°ê¸°(ìˆ˜ì •)ì´ ê°€ëŠ¥í•˜ë„ë¡
            'username': {'required': False}, // id ìˆ˜ì •ì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë‹¤
        }

    def update(self, instance, validated_data):
        instance.username = validated_data.get("username", instance.username)
        password = validated_data.get("password", instance.password)
        if not password.startswith("pbkdf2_sha256$"):
            instance.set_password(validated_data.get("password", instance.password))
        instance.email = validated_data.get("email", instance.email)
        instance.name = validated_data.get("name", instance.name)
        instance.save()

        return instance
```

#### view íŒŒì¼ì—ì„œ serializerë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ë„£ì–´ì£¼ëŠ” ì¸ìê°’

ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ serializer í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ update í•¨ìˆ˜ë¥¼ ì´ìš©í•œë‹¤.  
update í•¨ìˆ˜ëŠ” ì¸ìê°’ì„ ë‘ ê°œë¥¼ ê°–ê³  ìˆë‹¤. (ë¹„êµ ë° ìˆ˜ì •ë  instanceì™€ ê²€ì¦í•  ë°ì´í„°)

```python
def update(self, instance, validated_data):
```

ë¹„êµ ë° ìˆ˜ì •ëœ instance = í•´ë‹¹ apië¥¼ ìš”ì²­í•œ ì‚¬ìš©ìâœ”  
ê²€ì¦í•  ë°ì´í„° = ìˆ˜ì • ìš”ì²­ìœ¼ë¡œ ë„˜ì–´ì˜¨ ë°ì´í„°âœ”

views.py íŒŒì¼ì—ì„œ AccountDetailSerializerë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ì´ ë‘ ê°œì˜ ì¸ìê°’ê³¼ ë§¤ì¹­ì‹œì¼œì„œ ë³´ë‚´ì¤€ë‹¤.âœ”

```python
// accountapp > views.py
...
# ì‚¬ìš©ì ìˆ˜ì •
class UpdateAccount(APIView):
    authentication_classes = (SessionAuthentication,)
    permission_classes = (permissions.IsAuthenticated,)
    def patch(self, request, format=None):
        user = self.request.user
        serializer = AccountDetailSerializer(user, data=request.data, partial=True)âœ”
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

#### ë¹„ë°€ë²ˆí˜¸ëŠ” ì•”í˜¸í™”ì‹œì¼œì„œ ì €ì¥

í•œì°¸ í—¤ë§¸ë˜ ë¶€ë¶„ì´ë‹¤.  
íšŒì›ê°€ì…ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ 1234ë¡œ ìƒì„±í•˜ì˜€ë‹¤í•´ë„ dbì—ëŠ” ì•”í˜¸í™”ëœ ê°’ìœ¼ë¡œ ì €ì¥ì´ ëœë‹¤. ì´ëŠ” ìˆ˜ì •í•  ë•Œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì•”í˜¸í™”ë˜ì–´ì„œ ì €ì¥ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ë‹¤.  
í•˜ì§€ë§Œ ê¸°ì¡´ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ 1234 -> 1111ë¡œ ë³€ê²½í–ˆì„ ë•Œ serializerë¡œ ë„˜ì–´ì˜¨ ë°ì´í„°ëŠ” ì•”í˜¸í™”ë˜ì–´ ë„˜ì–´ì˜¤ëŠ”ê²Œ ì•„ë‹Œ, í”„ë¡ íŠ¸ì—ì„œ ë³´ë‚´ì£¼ëŠ” ê·¸ëŒ€ë¡œì˜ ë°ì´í„°ì¸ 111ë¡œ ë„˜ì–´ì˜¨ë‹¤.  
ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ instanceì˜ password ê°’ì„ set_password í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ê²€ì¦ëœ ë¹„ë°€ë²ˆí˜¸ë¡œ ì•”í˜¸í™”ì‹œì¼œì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

```python
if not password.startswith("pbkdf2_sha256$"):
            instance.set_password(validated_data.get("password", instance.password))
```
